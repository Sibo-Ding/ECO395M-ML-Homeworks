---
title: "DM&SL Project Food"
author: "Sibo Ding"
output: md_document
---

# Title

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)

library(dplyr)
library(tidyr)
library(lubridate)
```

I started to record what I ate everyday in July 2022 by a very incidental chance. Since then, I spent most of my time in Hong Kong until I moved to Austin in July 2023. When I was in HK, I was wondering whether people tend to eat better (to relax or compensate) or simpler (to save time) when they are busy? However, my life and food patterns in HK were so complicated and unpredictable to verify this hypothesis.  

Considering the feasibility, I decide to estimate and predict my life and food patterns in Austin. I am not very confident in the predictive accuracy for two reasons. First, although my life in Austin is simple due to some constraints, the data is from real human with certain flexibility and unpredictability. Second, the data set is small. However, it is still fun to know the driving factors of my life and food patterns.  

To implement this, I filter relevant `date` in Austin: keep `date` >= 2023-07-04, exclude Thanksgiving holiday (`date` in [2023-11-20, 2023-11-26]) and winter vacation (`date` in [2023-12-12,2024-01-11]).  

During this time, I am studying at University of Texas at Austin, so my life pattern heavily depends on the school calender. Thus, I create a `semester` variable: it equals to "summer" when `date` <= 2023-08-14, equals to "fall" when `date` in [2023-08-14, 2023-12-11], and equals to "spring" otherwise.  

Create `week_of_sem` column

## Check spring break




Below is the data frame:
```{r}
df <- read.csv("Food.csv", na.strings = "")

# Drop a column
# Convert to `Date` data type
df <- df |>
  select(-note) |>
  mutate(date = mdy(date))
head(df)
```

Convert wide data to long data  
Drop N/A in `food`
```{r}
df_long <- df |>
  pivot_longer(cols = c(lunch, dinner),
               names_to = "meal", 
               values_to = "food") |>
  filter(!is.na(food))
head(df_long)
```

Create 2 categorical columns using `case_when`  
Create a column, the difference in `date` between this observation and the last observation with the same `food_class`
```{r}
df1 <- df_long |> 
  mutate(food_class = case_when(
    food == "Home" ~ "home",
    food %in% c("J2 Dining", "Jester City Limits", "Kins Dining") ~ "canteen",
    TRUE ~ "other")) |>
  mutate(breakfast_or_not = case_when(
    is.na(breakfast) ~ 0,
    TRUE ~ 1)) |>
  group_by(food_class) |>
  mutate(days_since_last_eat = as.numeric(date - lag(date))) |>
  ungroup()
head(df1)
```

Drop N/A in `days_since_last_eat` (First meal of a `food_class`)  
Select columns  
Convert data type of several columns
```{r}
df2 <- df1 |> 
  filter(!is.na(days_since_last_eat)) |>
  select(-date, -breakfast, -food) |>
  mutate(across(
    c(dow, semester, week_of_sem, meal, food_class, breakfast_or_not),
    as.factor))
head(df2)
```

```{r}
df2 |> group_by(food_class) |> count() |> rename(count = n)
```







